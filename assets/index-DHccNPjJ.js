(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();var xt=Object.defineProperty,Tt=(t,e,s)=>e in t?xt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,c=(t,e,s)=>(Tt(t,typeof e!="symbol"?e+"":e,s),s);function ye(t,e){let s;const n=()=>{s!==void 0&&e&&e(s),s=void 0};return[()=>s===void 0?s=t(n):s,n]}function Y(t){const e=U(),{count:s}=e;e.unsubscribe(t),s&&!e.count&&Bt()}function ve(t){return U().subscribe(t),()=>Y(t)}class Ct{constructor(e,s={}){this.scope=e,this.options=s}print(e,...s){const n=new Date,r=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(n),{textColor:i,bgColor:o}=this.options,a="font-weight: bold;padding: 0 5px;border-radius:5px";console[e](`%c${r}%c / %c${this.scope}`,`${a};background-color: lightblue;color:black`,"",`${a};${i?`color:${i};`:""}${o?`background-color:${o}`:""}`,...s)}error(...e){this.print("error",...e)}log(...e){this.print("log",...e)}}const Q=new Ct("SDK",{bgColor:"forestgreen",textColor:"white"});let J=!1;const ge=({name:t,payload:e})=>{Q.log("Event received:",e?{name:t,payload:e}:{name:t})};function It(t){J!==t&&(J=t,t?ve(ge):Y(ge))}function At(...t){J&&Q.log(...t)}class P{constructor(){c(this,"listeners",new Map),c(this,"listenersCount",0),c(this,"subscribeListeners",[])}clear(){this.listeners.clear(),this.subscribeListeners=[]}get count(){return this.listenersCount+this.subscribeListeners.length}emit(e,...s){this.subscribeListeners.forEach(n=>n({event:e,args:s})),(this.listeners.get(e)||[]).forEach(([n,r])=>{n(...s),r&&this.off(e,n)})}on(e,s,n){let r=this.listeners.get(e);return r||this.listeners.set(e,r=[]),r.push([s,n]),this.listenersCount+=1,()=>this.off(e,s)}off(e,s){const n=this.listeners.get(e)||[];for(let r=0;r<n.length;r+=1)if(s===n[r][0]){n.splice(r,1),this.listenersCount-=1;return}}subscribe(e){return this.subscribeListeners.push(e),()=>this.unsubscribe(e)}unsubscribe(e){for(let s=0;s<this.subscribeListeners.length;s+=1)if(this.subscribeListeners[s]===e){this.subscribeListeners.splice(s,1);return}}}function K(t,e,s){return window.addEventListener(t,e,s),()=>window.removeEventListener(t,e,s)}function Z(...t){let e=!1;const s=t.flat(1);return[n=>!e&&s.push(n),()=>{e||(e=!0,s.forEach(n=>n()))},e]}class q extends Error{constructor(e,s,n){super(s,{cause:n}),this.type=e,Object.setPrototypeOf(this,q.prototype)}}function f(t,e,s){return new q(t,e,s)}const Ee="ERR_METHOD_UNSUPPORTED",Pe="ERR_METHOD_PARAMETER_UNSUPPORTED",Se="ERR_UNKNOWN_ENV",xe="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",Te="ERR_TIMED_OUT",Ce="ERR_UNEXPECTED_TYPE",X="ERR_PARSE",Ie="ERR_NAVIGATION_LIST_EMPTY",Ae="ERR_NAVIGATION_CURSOR_INVALID",Rt="ERR_NAVIGATION_ITEM_INVALID",kt="ERR_SSR_INIT",Re="ERR_INVALID_PATH_BASE";function T(){return f(Ce,"Value has unexpected type")}class B{constructor(e,s,n){this.parser=e,this.isOptional=s,this.type=n}parse(e){if(!(this.isOptional&&e===void 0))try{return this.parser(e)}catch(s){throw f(X,`Unable to parse value${this.type?` as ${this.type}`:""}`,s)}}optional(){return this.isOptional=!0,this}}function C(t,e){return()=>new B(t,!1,e)}const b=C(t=>{if(typeof t=="boolean")return t;const e=String(t);if(e==="1"||e==="true")return!0;if(e==="0"||e==="false")return!1;throw T()},"boolean");function ke(t,e){const s={};for(const n in t){const r=t[n];if(!r)continue;let i,o;if(typeof r=="function"||"parse"in r)i=n,o=typeof r=="function"?r:r.parse.bind(r);else{const{type:a}=r;i=r.from||n,o=typeof a=="function"?a:a.parse.bind(a)}try{const a=o(e(i));a!==void 0&&(s[n]=a)}catch(a){throw f(X,`Unable to parse field "${n}"`,a)}}return s}function Oe(t){let e=t;if(typeof e=="string"&&(e=JSON.parse(e)),typeof e!="object"||e===null||Array.isArray(e))throw T();return e}function g(t,e){return new B(s=>{const n=Oe(s);return ke(t,r=>n[r])},!1,e)}const y=C(t=>{if(typeof t=="number")return t;if(typeof t=="string"){const e=Number(t);if(!Number.isNaN(e))return e}throw T()},"number"),p=C(t=>{if(typeof t=="string"||typeof t=="number")return t.toString();throw T()},"string");function qe(t){return g({eventType:p(),eventData:e=>e}).parse(t)}function Ot(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(t=>{delete window[t]})}function F(t,e){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:t,eventData:e}),source:window.parent}))}function qt(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(t=>{let e=window;t.forEach((s,n,r)=>{if(n===r.length-1){e[s]=F;return}s in e||(e[s]={}),e=e[s]})})}const Nt={clipboard_text_received:g({req_id:p(),data:t=>t===null?t:p().optional().parse(t)}),custom_method_invoked:g({req_id:p(),result:t=>t,error:p().optional()}),popup_closed:{parse(t){return g({button_id:e=>e==null?void 0:p().parse(e)}).parse(t??{})}},viewport_changed:g({height:y(),width:t=>t==null?window.innerWidth:y().parse(t),is_state_stable:b(),is_expanded:b()})};function Dt(){const t=new P,e=new P;e.subscribe(n=>{t.emit("event",{name:n.event,payload:n.args[0]})}),qt();const[,s]=Z(Ot,K("resize",()=>{e.emit("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}),K("message",n=>{if(n.source!==window.parent)return;let r;try{r=qe(n.data)}catch{return}const{eventType:i,eventData:o}=r,a=Nt[i];try{const h=a?a.parse(o):o;e.emit(...h?[i,h]:[i])}catch(h){Q.error(`An error occurred processing the "${i}" event from the Telegram application.
Please, file an issue here:
https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose`,r,h)}}),()=>t.clear(),()=>e.clear());return[{on:e.on.bind(e),off:e.off.bind(e),subscribe(n){return t.on("event",n)},unsubscribe(n){t.off("event",n)},get count(){return e.count+t.count}},s]}const[Vt,Bt]=ye(t=>{const[e,s]=Dt(),n=e.off.bind(e);return e.off=(r,i)=>{const{count:o}=e;n(r,i),o&&!e.count&&t()},[e,s]},([,t])=>t());function U(){return Vt()[0]}function N(t,e){U().off(t,e)}function m(t,e,s){return U().on(t,e,s)}function D(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Ne(t,e){const s=t.split("."),n=e.split("."),r=Math.max(s.length,n.length);for(let i=0;i<r;i+=1){const o=parseInt(s[i]||"0",10),a=parseInt(n[i]||"0",10);if(o!==a)return o>a?1:-1}return 0}function _(t,e){return Ne(t,e)<=0}function v(t,e,s){if(typeof s=="string"){if(t==="web_app_open_link"){if(e==="try_instant_view")return _("6.4",s);if(e==="try_browser")return _("7.6",s)}if(t==="web_app_set_header_color"&&e==="color")return _("6.9",s);if(t==="web_app_close"&&e==="return_back")return _("7.6",s)}switch(t){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return _("6.1",e);case"web_app_open_popup":return _("6.2",e);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return _("6.4",e);case"web_app_switch_inline_query":return _("6.7",e);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return _("6.9",e);case"web_app_setup_settings_button":return _("6.10",e);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return _("7.2",e);case"web_app_setup_swipe_behavior":return _("7.7",e);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(t)}}function De(t){return"external"in t&&D(t.external)&&"notify"in t.external&&typeof t.external.notify=="function"}function Ve(t){return"TelegramWebviewProxy"in t&&D(t.TelegramWebviewProxy)&&"postEvent"in t.TelegramWebviewProxy&&typeof t.TelegramWebviewProxy.postEvent=="function"}function ee(){try{return window.self!==window.top}catch{return!0}}const Ut="https://web.telegram.org";let Be=Ut;function Lt(t){Be=t}function Ue(){return Be}function S(t,e,s){let n={},r;if(!e&&!s?n={}:e&&s?(n=s,r=e):e&&("targetOrigin"in e?n=e:r=e),At("Posting event:",r?{event:t,data:r}:{event:t}),ee())return window.parent.postMessage(JSON.stringify({eventType:t,eventData:r}),n.targetOrigin||Ue());if(De(window)){window.external.notify(JSON.stringify({eventType:t,eventData:r}));return}if(Ve(window)){window.TelegramWebviewProxy.postEvent(t,JSON.stringify(r));return}throw f(Se,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside the Telegram application environment.")}function Le(t){return(e,s)=>{if(!v(e,t))throw f(Ee,`Method "${e}" is unsupported in Mini Apps version ${t}`);if(D(s)&&e==="web_app_set_header_color"&&"color"in s&&!v(e,"color",t))throw f(Pe,`Parameter "color" of "${e}" method is unsupported in Mini Apps version ${t}`);return S(e,s)}}function te(t){return({req_id:e})=>e===t}function $e(t){return f(Te,`Timeout reached: ${t}ms`)}function se(t,e){return Promise.race([typeof t=="function"?t():t,new Promise((s,n)=>{setTimeout(()=>{n($e(e))},e)})])}async function d(t){let e;const s=new Promise(a=>e=a),{event:n,capture:r,timeout:i}=t,[,o]=Z((Array.isArray(n)?n:[n]).map(a=>m(a,h=>{(!r||(Array.isArray(n)?r({event:a,payload:h}):r(h)))&&e(h)})));try{return(t.postEvent||S)(t.method,t.params),await(i?se(s,i):s)}finally{o()}}async function E(t,e,s,n={}){const{result:r,error:i}=await d({...n,method:"web_app_invoke_custom_method",event:"custom_method_invoked",params:{method:t,params:e,req_id:s},capture:te(s)});if(i)throw f(xe,i);return r}function V(...t){return t.map(e=>{if(typeof e=="string")return e;if(D(e))return V(Object.entries(e).map(s=>s[1]&&s[0]));if(Array.isArray(e))return V(...e)}).filter(Boolean).join(" ")}function $t(...t){return t.reduce((e,s)=>(D(s)&&Object.entries(s).forEach(([n,r])=>{const i=V(e[n],r);i.length&&(e[n]=i)}),e),{})}function L(t){return/^#[\da-f]{6}$/i.test(t)}function Me(t){return/^#[\da-f]{3}$/i.test(t)}function ne(t){const e=t.replace(/\s/g,"").toLowerCase();if(L(e))return e;if(Me(e)){let n="#";for(let r=0;r<3;r+=1)n+=e[1+r].repeat(2);return n}const s=e.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||e.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!s)throw new Error(`Value "${t}" does not satisfy any of known RGB formats.`);return s.slice(1).reduce((n,r)=>{const i=parseInt(r,10).toString(16);return n+(i.length===1?"0":"")+i},"#")}function re(t){const e=ne(t);return Math.sqrt([.299,.587,.114].reduce((s,n,r)=>{const i=parseInt(e.slice(1+r*2,1+(r+1)*2),16);return s+i*i*n},0))<120}class Mt{constructor(e){c(this,"ee",new P),c(this,"on",this.ee.on.bind(this.ee)),c(this,"off",this.ee.off.bind(this.ee)),this.state=e}clone(){return{...this.state}}set(e,s){Object.entries(typeof e=="string"?{[e]:s}:e).reduce((n,[r,i])=>this.state[r]===i||i===void 0?n:(this.state[r]=i,this.ee.emit(`change:${r}`,i),!0),!1)&&this.ee.emit("change",this.state)}get(e){return this.state[e]}}class ie{constructor(e){c(this,"state"),c(this,"get"),c(this,"set"),c(this,"clone"),this.state=new Mt(e),this.set=this.state.set.bind(this.state),this.get=this.state.get.bind(this.state),this.clone=this.state.clone.bind(this.state)}}function We(t,e){return s=>v(e[s],t)}class oe extends ie{constructor(e,s,n){super(e),c(this,"supports"),this.supports=We(s,n)}}class He extends oe{constructor(e,s,n){super({isVisible:e},s,{show:"web_app_setup_back_button",hide:"web_app_setup_back_button"}),c(this,"on",(r,i)=>r==="click"?m("back_button_pressed",i):this.state.on(r,i)),c(this,"off",(r,i)=>r==="click"?N("back_button_pressed",i):this.state.off(r,i)),this.postEvent=n}set isVisible(e){this.set("isVisible",e),this.postEvent("web_app_setup_back_button",{is_visible:e})}get isVisible(){return this.get("isVisible")}hide(){this.isVisible=!1}show(){this.isVisible=!0}}const ae=C(t=>t instanceof Date?t:new Date(y().parse(t)*1e3),"Date");function $(t,e){return new B(s=>{if(typeof s!="string"&&!(s instanceof URLSearchParams))throw T();const n=typeof s=="string"?new URLSearchParams(s):s;return ke(t,r=>{const i=n.get(r);return i===null?void 0:i})},!1,e)}const Wt=g({id:y(),type:p(),title:p(),photoUrl:{type:p().optional(),from:"photo_url"},username:p().optional()},"Chat").optional(),me=g({addedToAttachmentMenu:{type:b().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:b().optional(),from:"allows_write_to_pm"},firstName:{type:p(),from:"first_name"},id:y(),isBot:{type:b().optional(),from:"is_bot"},isPremium:{type:b().optional(),from:"is_premium"},languageCode:{type:p().optional(),from:"language_code"},lastName:{type:p().optional(),from:"last_name"},photoUrl:{type:p().optional(),from:"photo_url"},username:p().optional()},"User").optional();function Ge(){return $({authDate:{type:ae(),from:"auth_date"},canSendAfter:{type:y().optional(),from:"can_send_after"},chat:Wt,chatInstance:{type:p().optional(),from:"chat_instance"},chatType:{type:p().optional(),from:"chat_type"},hash:p(),queryId:{type:p().optional(),from:"query_id"},receiver:me,startParam:{type:p().optional(),from:"start_param"},user:me},"InitData")}const je=C(t=>ne(p().parse(t)),"rgb");function Ht(t){return t.replace(/_[a-z]/g,e=>e[1].toUpperCase())}function Gt(t){return t.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)}const ze=C(t=>{const e=je().optional();return Object.entries(Oe(t)).reduce((s,[n,r])=>(s[Ht(n)]=e.parse(r),s),{})},"ThemeParams");function M(t){return $({botInline:{type:b().optional(),from:"tgWebAppBotInline"},initData:{type:Ge().optional(),from:"tgWebAppData"},initDataRaw:{type:p().optional(),from:"tgWebAppData"},platform:{type:p(),from:"tgWebAppPlatform"},showSettings:{type:b().optional(),from:"tgWebAppShowSettings"},startParam:{type:p().optional(),from:"tgWebAppStartParam"},themeParams:{type:ze(),from:"tgWebAppThemeParams"},version:{type:p(),from:"tgWebAppVersion"}}).parse(t)}function Je(t){return M(t.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function jt(){return Je(window.location.href)}function Ke(){return performance.getEntriesByType("navigation")[0]}function zt(){const t=Ke();if(!t)throw new Error("Unable to get first navigation entry.");return Je(t.name)}function Fe(t){return`telegram-apps/${t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}`}function Ye(t,e){sessionStorage.setItem(Fe(t),JSON.stringify(e))}function Qe(t){const e=sessionStorage.getItem(Fe(t));try{return e?JSON.parse(e):void 0}catch{}}function Jt(){return M(Qe("launchParams")||"")}function ce(t){return JSON.stringify(Object.fromEntries(Object.entries(t).map(([e,s])=>[Gt(e),s])))}function Ze(t){const{initDataRaw:e,themeParams:s,platform:n,version:r,showSettings:i,startParam:o,botInline:a}=t,h=new URLSearchParams;return h.set("tgWebAppPlatform",n),h.set("tgWebAppThemeParams",ce(s)),h.set("tgWebAppVersion",r),e&&h.set("tgWebAppData",e),o&&h.set("tgWebAppStartParam",o),typeof i=="boolean"&&h.set("tgWebAppShowSettings",i?"1":"0"),typeof a=="boolean"&&h.set("tgWebAppBotInline",a?"1":"0"),h.toString()}function Xe(t){Ye("launchParams",Ze(t))}function et(){const t=[];for(const e of[jt,zt,Jt])try{const s=e();return Xe(s),s}catch(s){t.push(s instanceof Error?s.message:JSON.stringify(s))}throw new Error([`Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?
`,"📖 Refer to docs for more information:",`https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment
`,"Collected errors:",t.map(e=>`— ${e}`)].join(`
`))}function he(){const t=Ke();return!!(t&&t.type==="reload")}function Kt(){let t=0;return()=>(t+=1).toString()}const[Ft]=ye(Kt);function l(t,e){return()=>{const s=et(),n={...s,postEvent:Le(s.version),createRequestId:Ft()};if(typeof t=="function")return t(n);const[r,i,o]=Z(),a=e({...n,state:he()?Qe(t):void 0,addCleanup:r}),h=u=>(o||r(u.on("change",St=>{Ye(t,St)})),u);return[a instanceof Promise?a.then(h):h(a),i]}}const Yt=l("backButton",({postEvent:t,version:e,state:s={isVisible:!1}})=>new He(s.isVisible,e,t));class I extends oe{constructor(){super(...arguments),c(this,"on",this.state.on.bind(this.state)),c(this,"off",this.state.off.bind(this.state))}}function tt(t){const e=t.available?t:{device_id:"",token_saved:!1,access_requested:!1,access_granted:!1,type:""};return{available:!0,type:e.type,deviceId:e.device_id,tokenSaved:e.token_saved,accessRequested:e.access_requested,accessGranted:e.access_granted}}class st extends I{constructor({postEvent:e,version:s,...n}){super(n,s,{auth:"web_app_biometry_request_auth",openSettings:"web_app_biometry_open_settings",requestAccess:"web_app_biometry_request_access",updateToken:"web_app_biometry_update_token"}),c(this,"postEvent"),c(this,"authPromise"),c(this,"accessPromise"),this.postEvent=e}get available(){return this.get("available")}get accessGranted(){return this.get("accessGranted")}get accessRequested(){return this.get("accessRequested")}async authenticate({reason:e,...s}){return this.authPromise||(this.authPromise=d({...s,method:"web_app_biometry_request_auth",event:"biometry_auth_requested",postEvent:this.postEvent,params:{reason:(e||"").trim()}}).then(({token:n})=>n).finally(()=>this.authPromise=void 0)),this.authPromise}get deviceId(){return this.get("deviceId")}openSettings(){this.postEvent("web_app_biometry_open_settings")}requestAccess({reason:e,...s}={}){return this.accessPromise||(this.accessPromise=d({...s,postEvent:this.postEvent,method:"web_app_biometry_request_access",event:"biometry_info_received",params:{reason:e||""}}).then(n=>{const r=tt(n);return this.set(r),r.accessGranted}).finally(()=>this.accessPromise=void 0)),this.accessPromise}get biometryType(){return this.get("biometryType")}get tokenSaved(){return this.get("tokenSaved")}async updateToken({token:e,...s}={}){return["removed","updated"].includes((await d({...s,postEvent:this.postEvent,method:"web_app_biometry_update_token",event:"biometry_token_updated",params:{token:e||""}})).status)}}async function nt(t){return tt(await d({...t||{},method:"web_app_biometry_get_info",event:"biometry_info_received"}))}const Qt=l("biometryManager",async({postEvent:t,version:e,state:s})=>new st({...s||v("web_app_biometry_get_info",e)?s||await nt({timeout:1e3}):{available:!1,accessGranted:!1,accessRequested:!1,tokenSaved:!1,deviceId:""},version:e,postEvent:t}));class pe extends ie{constructor(){super(...arguments),c(this,"on",this.state.on.bind(this.state)),c(this,"off",this.state.off.bind(this.state))}}class rt extends pe{constructor(e,s){super({isConfirmationNeeded:e}),this.postEvent=s}set isConfirmationNeeded(e){this.set("isConfirmationNeeded",e),this.postEvent("web_app_setup_closing_behavior",{need_confirmation:e})}get isConfirmationNeeded(){return this.get("isConfirmationNeeded")}disableConfirmation(){this.isConfirmationNeeded=!1}enableConfirmation(){this.isConfirmationNeeded=!0}}const Zt=l("closingBehavior",({postEvent:t,state:e={isConfirmationNeeded:!1}})=>new rt(e.isConfirmationNeeded,t));class ue{constructor(e,s){c(this,"supports"),this.supports=We(e,s)}}function Xt(t){if(Array.isArray(t))return t;if(typeof t=="string")try{const e=JSON.parse(t);if(Array.isArray(e))return e}catch{}throw T()}class es extends B{constructor(e,s,n){super(Xt,s,n),c(this,"itemParser"),this.itemParser=typeof e=="function"?e:e.parse.bind(e)}parse(e){const s=super.parse(e);return s===void 0?s:s.map(this.itemParser)}of(e){return this.itemParser=typeof e=="function"?e:e.parse.bind(e),this}}function it(t){return new es(e=>e,!1,t)}function be(t,e){return Object.fromEntries(t.map(s=>[s,e]))}class ot extends ue{constructor(e,s,n){super(e,{delete:"web_app_invoke_custom_method",get:"web_app_invoke_custom_method",getKeys:"web_app_invoke_custom_method",set:"web_app_invoke_custom_method"}),this.createRequestId=s,this.postEvent=n}async delete(e,s={}){const n=Array.isArray(e)?e:[e];n.length&&await E("deleteStorageValues",{keys:n},this.createRequestId(),{...s,postEvent:this.postEvent})}async getKeys(e={}){return it().of(p()).parse(await E("getStorageKeys",{},this.createRequestId(),{...e,postEvent:this.postEvent}))}async get(e,s={}){const n=Array.isArray(e)?e:[e];if(!n.length)return be(n,"");const r=await E("getStorageValues",{keys:n},this.createRequestId(),{...s,postEvent:this.postEvent}),i=g(be(n,p()),"CloudStorageData").parse(r);return Array.isArray(e)?i:i[e]}async set(e,s,n={}){await E("saveStorageValue",{key:e,value:s},this.createRequestId(),{...n,postEvent:this.postEvent})}}const ts=l(({createRequestId:t,postEvent:e,version:s})=>new ot(s,t,e));class at extends ue{constructor(e,s){super(e,{impactOccurred:"web_app_trigger_haptic_feedback",notificationOccurred:"web_app_trigger_haptic_feedback",selectionChanged:"web_app_trigger_haptic_feedback"}),this.postEvent=s}impactOccurred(e){this.postEvent("web_app_trigger_haptic_feedback",{type:"impact",impact_style:e})}notificationOccurred(e){this.postEvent("web_app_trigger_haptic_feedback",{type:"notification",notification_type:e})}selectionChanged(){this.postEvent("web_app_trigger_haptic_feedback",{type:"selection_change"})}}const ss=l(({version:t,postEvent:e})=>new at(t,e));class ct{constructor(e){this.initData=e}get authDate(){return this.initData.authDate}get canSendAfter(){return this.initData.canSendAfter}get canSendAfterDate(){const{canSendAfter:e}=this;return e?new Date(this.authDate.getTime()+e*1e3):void 0}get chat(){return this.initData.chat}get chatType(){return this.initData.chatType}get chatInstance(){return this.initData.chatInstance}get hash(){return this.initData.hash}get queryId(){return this.initData.queryId}get receiver(){return this.initData.receiver}get startParam(){return this.initData.startParam}get user(){return this.initData.user}}const ns=l(({initData:t})=>t?new ct(t):void 0);function rs(t){return Ge().parse(t)}class ht extends I{constructor(e,s,n){super({isOpened:e},s,{open:"web_app_open_invoice"}),this.postEvent=n}set isOpened(e){this.set("isOpened",e)}get isOpened(){return this.get("isOpened")}async open(e,s){if(this.isOpened)throw new Error("Invoice is already opened");let n;if(!s)n=e;else{const{hostname:r,pathname:i}=new URL(e,window.location.href);if(r!=="t.me")throw new Error(`Incorrect hostname: ${r}`);const o=i.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/);if(!o)throw new Error('Link pathname has incorrect format. Expected to receive "/invoice/{slug}" or "/${slug}"');[,,n]=o}this.isOpened=!0;try{return(await d({method:"web_app_open_invoice",event:"invoice_closed",params:{slug:n},postEvent:this.postEvent,capture(r){return n===r.slug}})).status}finally{this.isOpened=!1}}}const is=l(({version:t,postEvent:e})=>new ht(!1,t,e));class pt extends ie{constructor({postEvent:e,...s}){super(s),c(this,"postEvent"),c(this,"on",(n,r)=>n==="click"?m("main_button_pressed",r):this.state.on(n,r)),c(this,"off",(n,r)=>n==="click"?N("main_button_pressed",r):this.state.off(n,r)),this.postEvent=e}get bgColor(){return this.get("bgColor")}commit(){this.text!==""&&this.postEvent("web_app_setup_main_button",{is_visible:this.isVisible,is_active:this.isEnabled,is_progress_visible:this.isLoaderVisible,text:this.text,color:this.bgColor,text_color:this.textColor})}disable(){return this.isEnabled=!1,this}enable(){return this.isEnabled=!0,this}hide(){return this.isVisible=!1,this}hideLoader(){return this.isLoaderVisible=!1,this}set isEnabled(e){this.setParams({isEnabled:e})}get isEnabled(){return this.get("isEnabled")}set isLoaderVisible(e){this.setParams({isLoaderVisible:e})}get isLoaderVisible(){return this.get("isLoaderVisible")}set isVisible(e){this.setParams({isVisible:e})}get isVisible(){return this.get("isVisible")}show(){return this.isVisible=!0,this}showLoader(){return this.isLoaderVisible=!0,this}setText(e){return this.setParams({text:e})}setTextColor(e){return this.setParams({textColor:e})}setBgColor(e){return this.setParams({bgColor:e})}setParams(e){return this.set(e),this.commit(),this}get text(){return this.get("text")}get textColor(){return this.get("textColor")}}const os=l("mainButton",({postEvent:t,themeParams:e,state:s={isVisible:!1,isEnabled:!1,text:"",isLoaderVisible:!1,textColor:e.buttonTextColor||"#ffffff",bgColor:e.buttonColor||"#000000"}})=>new pt({...s,postEvent:t}));function as(){return $({contact:g({userId:{type:y(),from:"user_id"},phoneNumber:{type:p(),from:"phone_number"},firstName:{type:p(),from:"first_name"},lastName:{type:p().optional(),from:"last_name"}}),authDate:{type:ae(),from:"auth_date"},hash:p()},"RequestedContact")}function ut(t,e){return s=>{const[n,r]=e[s];return v(n,r,t)}}function cs(t){return new Promise(e=>{setTimeout(e,t)})}class lt extends I{constructor({postEvent:e,createRequestId:s,version:n,botInline:r,...i}){super(i,n,{requestPhoneAccess:"web_app_request_phone",requestWriteAccess:"web_app_request_write_access",switchInlineQuery:"web_app_switch_inline_query",setHeaderColor:"web_app_set_header_color",setBackgroundColor:"web_app_set_background_color"}),c(this,"botInline"),c(this,"postEvent"),c(this,"createRequestId"),c(this,"requestPhoneAccessPromise"),c(this,"requestWriteAccessPromise"),c(this,"supportsParam"),this.createRequestId=s,this.postEvent=e,this.botInline=r;const o=this.supports.bind(this);this.supports=a=>o(a)?a!=="switchInlineQuery"||r:!1,this.supportsParam=ut(n,{"setHeaderColor.color":["web_app_set_header_color","color"],"close.returnBack":["web_app_close","return_back"]})}async getRequestedContact({timeout:e=1e4}={}){return as().parse(await E("getRequestedContact",{},this.createRequestId(),{postEvent:this.postEvent,timeout:e}))}get bgColor(){return this.get("bgColor")}close(e){this.postEvent("web_app_close",this.supportsParam("close.returnBack")?{return_back:e}:{})}get headerColor(){return this.get("headerColor")}get isBotInline(){return this.botInline}get isDark(){return re(this.bgColor)}ready(){this.postEvent("web_app_ready")}async requestContact({timeout:e=5e3}={}){try{return await this.getRequestedContact()}catch{}if(await this.requestPhoneAccess()!=="sent")throw new Error("Access denied.");const s=Date.now()+e;let n=50;return se(async()=>{for(;Date.now()<s;){try{return await this.getRequestedContact()}catch{}await cs(n),n+=50}throw $e(e)},e)}async requestPhoneAccess(e={}){return this.requestPhoneAccessPromise||(this.requestPhoneAccessPromise=d({...e,method:"web_app_request_phone",event:"phone_requested",postEvent:this.postEvent}).then(({status:s})=>s).finally(()=>this.requestPhoneAccessPromise=void 0)),this.requestPhoneAccessPromise}async requestWriteAccess(e={}){return this.requestWriteAccessPromise||(this.requestWriteAccessPromise=d({...e,method:"web_app_request_write_access",event:"write_access_requested",postEvent:this.postEvent}).then(({status:s})=>s).finally(()=>this.requestWriteAccessPromise=void 0)),this.requestWriteAccessPromise}sendData(e){const{size:s}=new Blob([e]);if(!s||s>4096)throw new Error(`Passed data has incorrect size: ${s}`);this.postEvent("web_app_data_send",{data:e})}setHeaderColor(e){this.postEvent("web_app_set_header_color",L(e)?{color:e}:{color_key:e}),this.set("headerColor",e)}setBgColor(e){this.postEvent("web_app_set_background_color",{color:e}),this.set("bgColor",e)}switchInlineQuery(e,s=[]){if(!this.supports("switchInlineQuery")&&!this.isBotInline)throw new Error("Method is unsupported because Mini App should be launched in inline mode.");this.postEvent("web_app_switch_inline_query",{query:e,chat_types:s})}}const hs=l("miniApp",({themeParams:t,botInline:e=!1,state:s={bgColor:t.bgColor||"#ffffff",headerColor:t.headerBgColor||"#000000"},...n})=>new lt({...n,...s,botInline:e}));function ps(t){const e=t.message.trim(),s=(t.title||"").trim(),n=t.buttons||[];let r;if(s.length>64)throw new Error(`Title has incorrect size: ${s.length}`);if(!e.length||e.length>256)throw new Error(`Message has incorrect size: ${e.length}`);if(n.length>3)throw new Error(`Buttons have incorrect size: ${n.length}`);return n.length?r=n.map(i=>{const{id:o=""}=i;if(o.length>64)throw new Error(`Button ID has incorrect size: ${o}`);if(!i.type||i.type==="default"||i.type==="destructive"){const a=i.text.trim();if(!a.length||a.length>64){const h=i.type||"default";throw new Error(`Button text with type "${h}" has incorrect size: ${i.text.length}`)}return{...i,text:a,id:o}}return{...i,id:o}}):r=[{type:"close",id:""}],{title:s,message:e,buttons:r}}class dt extends I{constructor(e,s,n){super({isOpened:e},s,{open:"web_app_open_popup"}),this.postEvent=n}set isOpened(e){this.set("isOpened",e)}get isOpened(){return this.get("isOpened")}async open(e){if(this.isOpened)throw new Error("Popup is already opened.");this.isOpened=!0;try{const{button_id:s=null}=await d({event:"popup_closed",method:"web_app_open_popup",postEvent:this.postEvent,params:ps(e)});return s}finally{this.isOpened=!1}}}const us=l(({postEvent:t,version:e})=>new dt(!1,e,t));class _t extends I{constructor(e,s,n){super({isOpened:e},s,{close:"web_app_close_scan_qr_popup",open:"web_app_open_scan_qr_popup"}),this.postEvent=n}close(){this.postEvent("web_app_close_scan_qr_popup"),this.isOpened=!1}set isOpened(e){this.set("isOpened",e)}get isOpened(){return this.get("isOpened")}async open(e){if(this.isOpened)throw new Error("The scanner is already opened");const{text:s,capture:n}=(typeof e=="string"?{text:e}:e)||{};this.isOpened=!0;try{const r=(await d({method:"web_app_open_scan_qr_popup",event:["qr_text_received","scan_qr_popup_closed"],postEvent:this.postEvent,params:{text:s},capture(i){return i.event==="scan_qr_popup_closed"||!n||n(i.payload)}})||{}).data||null;return r&&this.close(),r}finally{this.isOpened=!1}}}const ls=l(({version:t,postEvent:e})=>new _t(!1,t,e));class ft extends oe{constructor(e,s,n){super({isVisible:e},s,{show:"web_app_setup_settings_button",hide:"web_app_setup_settings_button"}),c(this,"on",(r,i)=>r==="click"?m("settings_button_pressed",i):this.state.on(r,i)),c(this,"off",(r,i)=>r==="click"?N("settings_button_pressed",i):this.state.off(r,i)),this.postEvent=n}set isVisible(e){this.set("isVisible",e),this.postEvent("web_app_setup_settings_button",{is_visible:e})}get isVisible(){return this.get("isVisible")}hide(){this.isVisible=!1}show(){this.isVisible=!0}}const ds=l("settingsButton",({version:t,postEvent:e,state:s={isVisible:!1}})=>new ft(s.isVisible,t,e));class gt extends I{constructor(e,s,n){super({isVerticalSwipeEnabled:e},s,{disableVerticalSwipe:"web_app_setup_swipe_behavior",enableVerticalSwipe:"web_app_setup_swipe_behavior"}),this.postEvent=n}set isVerticalSwipeEnabled(e){this.set("isVerticalSwipeEnabled",e),this.postEvent("web_app_setup_swipe_behavior",{allow_vertical_swipe:e})}get isVerticalSwipeEnabled(){return this.get("isVerticalSwipeEnabled")}disableVerticalSwipe(){this.isVerticalSwipeEnabled=!1}enableVerticalSwipe(){this.isVerticalSwipeEnabled=!0}}const _s=l("swipeBehavior",({postEvent:t,state:e={isVerticalSwipeEnabled:!0},version:s})=>new gt(e.isVerticalSwipeEnabled,s,t));function le(t){return ze().parse(t)}class mt extends pe{get accentTextColor(){return this.get("accentTextColor")}get bgColor(){return this.get("bgColor")}get buttonColor(){return this.get("buttonColor")}get buttonTextColor(){return this.get("buttonTextColor")}get destructiveTextColor(){return this.get("destructiveTextColor")}getState(){return this.clone()}get headerBgColor(){return this.get("headerBgColor")}get hintColor(){return this.get("hintColor")}get isDark(){return!this.bgColor||re(this.bgColor)}get linkColor(){return this.get("linkColor")}get secondaryBgColor(){return this.get("secondaryBgColor")}get sectionBgColor(){return this.get("sectionBgColor")}get sectionHeaderTextColor(){return this.get("sectionHeaderTextColor")}get sectionSeparatorColor(){return this.get("sectionHeaderTextColor")}listen(){return m("theme_changed",e=>{this.set(le(e.theme_params))})}get subtitleTextColor(){return this.get("subtitleTextColor")}get textColor(){return this.get("textColor")}}const fs=l("themeParams",({themeParams:t,state:e=t,addCleanup:s})=>{const n=new mt(e);return s(n.listen()),n});function gs(t={}){return d({...t,method:"web_app_request_theme",event:"theme_changed"}).then(le)}function k(t,e){return t.startsWith(e)?t:`${e}${t}`}function x(t){return new URL(typeof t=="string"?t:`${t.pathname||""}${k(t.search||"","?")}${k(t.hash||"","#")}`,"http://a")}class bt extends ue{constructor(e,s,n){super(e,{readTextFromClipboard:"web_app_read_text_from_clipboard"}),c(this,"supportsParam"),this.version=e,this.createRequestId=s,this.postEvent=n,this.supportsParam=ut(e,{"openLink.tryInstantView":["web_app_open_link","try_instant_view"]})}openLink(e,s){const n=x(e).toString();if(!v("web_app_open_link",this.version)){window.open(n,"_blank");return}const r=typeof s=="boolean"?{tryInstantView:s}:s||{};this.postEvent("web_app_open_link",{url:n,try_browser:r.tryBrowser,try_instant_view:r.tryInstantView})}openTelegramLink(e){const{hostname:s,pathname:n,search:r}=new URL(e,"https://t.me");if(s!=="t.me")throw new Error(`URL has not allowed hostname: ${s}. Only "t.me" is allowed`);if(!v("web_app_open_tg_link",this.version)){window.location.href=e;return}this.postEvent("web_app_open_tg_link",{path_full:n+r})}async readTextFromClipboard(){const e=this.createRequestId(),{data:s=null}=await d({method:"web_app_read_text_from_clipboard",event:"clipboard_text_received",postEvent:this.postEvent,params:{req_id:e},capture:te(e)});return s}shareURL(e,s){this.openTelegramLink("https://t.me/share/url?"+new URLSearchParams({url:e,text:s||""}).toString().replace(/\+/g,"%20"))}}const ms=l(({version:t,postEvent:e,createRequestId:s})=>new bt(t,s,e));async function de(t={}){const{is_expanded:e,is_state_stable:s,...n}=await d({...t,method:"web_app_request_viewport",event:"viewport_changed"});return{...n,isExpanded:e,isStateStable:s}}function A(t){return t<0?0:t}class wt extends pe{constructor({postEvent:e,stableHeight:s,height:n,width:r,isExpanded:i}){super({height:A(n),isExpanded:i,stableHeight:A(s),width:A(r)}),c(this,"postEvent"),this.postEvent=e}async sync(e){const{isStateStable:s,...n}=await de(e);this.set({...n,stableHeight:s?n.height:this.get("stableHeight")})}get height(){return this.get("height")}get stableHeight(){return this.get("stableHeight")}listen(){return m("viewport_changed",e=>{const{height:s,width:n,is_expanded:r,is_state_stable:i}=e,o=A(s);this.set({height:o,isExpanded:r,width:A(n),...i?{stableHeight:o}:{}})})}get isExpanded(){return this.get("isExpanded")}get width(){return this.get("width")}expand(){this.postEvent("web_app_expand"),this.set("isExpanded",!0)}get isStable(){return this.stableHeight===this.height}}const bs=l("viewport",async({state:t,platform:e,postEvent:s,addCleanup:n})=>{let r=!1,i=0,o=0,a=0;if(t)r=t.isExpanded,i=t.height,o=t.width,a=t.stableHeight;else if(["macos","tdesktop","unigram","webk","weba","web"].includes(e))r=!0,i=window.innerHeight,o=window.innerWidth,a=window.innerHeight;else{const u=await de({timeout:1e3,postEvent:s});r=u.isExpanded,i=u.height,o=u.width,a=u.isStateStable?i:0}const h=new wt({postEvent:s,height:i,width:o,stableHeight:a,isExpanded:r});return n(h.listen()),h});function w(t,e){document.documentElement.style.setProperty(t,e)}function ws(t,e,s){s||(s=a=>`--tg-${a}-color`);const n=s("header"),r=s("bg"),i=()=>{const{headerColor:a}=t;if(L(a))w(n,a);else{const{bgColor:h,secondaryBgColor:u}=e;a==="bg_color"&&h?w(n,h):a==="secondary_bg_color"&&u&&w(n,u)}w(r,t.bgColor)},o=[e.on("change",i),t.on("change",i)];return i(),()=>o.forEach(a=>a())}function ys(t,e){e||(e=n=>`--tg-theme-${n.replace(/[A-Z]/g,r=>`-${r.toLowerCase()}`)}`);const s=()=>{Object.entries(t.getState()).forEach(([n,r])=>{r&&w(e(n),r)})};return s(),t.on("change",s)}function vs(t,e){e||(e=u=>`--tg-viewport-${u}`);const[s,n,r]=["height","width","stable-height"].map(u=>e(u)),i=()=>w(s,`${t.height}px`),o=()=>w(n,`${t.width}px`),a=()=>w(r,`${t.stableHeight}px`),h=[t.on("change:height",i),t.on("change:width",o),t.on("change:stableHeight",a)];return i(),o(),a(),()=>h.forEach(u=>u())}function Es(t=!0){const e=[m("reload_iframe",()=>{S("iframe_will_reload"),window.location.reload()})],s=()=>e.forEach(n=>n());if(t){const n=document.createElement("style");n.id="telegram-custom-styles",document.head.appendChild(n),e.push(m("set_custom_style",r=>{n.innerHTML=r}),()=>document.head.removeChild(n))}return S("iframe_ready",{reload_supported:!0}),s}function Ps(){return typeof window>"u"}async function Ss(){if(Ve(window))return!0;try{return await d({method:"web_app_request_theme",event:"theme_changed",timeout:100}),!0}catch{return!1}}function xs(t){const e=typeof t=="string"?M(t):t;Xe(e);function s(r){if(typeof r=="string")try{const{eventType:i}=qe(r);i==="web_app_request_theme"&&F("theme_changed",{theme_params:JSON.parse(ce(e.themeParams))}),i==="web_app_request_viewport"&&F("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}catch{}}if(ee()){const r=window.parent.postMessage.bind(window.parent);window.parent.postMessage=i=>{s(i),r(i)};return}if(De(window)){const r=window.external.notify.bind(window.external);window.external.notify=i=>{s(i),r(i)};return}const n=window.TelegramWebviewProxy;window.TelegramWebviewProxy={...n||{},postEvent(...r){s(JSON.stringify({eventType:r[0],eventData:r[1]})),n&&n.postEvent(...r)}}}function yt(t){return t instanceof q}function Ts(t,e){return yt(t)&&t.type===e}function W(t,e){let s,n,r;return typeof t=="string"?s=t:(s=t.pathname===void 0?e:t.pathname,n=t.params,r=t.id),Object.freeze({id:r||(Math.random()*2**14|0).toString(16),pathname:s,params:n})}class vt{constructor(e,s,n=S){if(c(this,"history"),c(this,"ee",new P),c(this,"attached",!1),c(this,"back",()=>this.go(-1)),c(this,"on",this.ee.on.bind(this.ee)),c(this,"off",this.ee.off.bind(this.ee)),this._index=s,this.postEvent=n,e.length===0)throw f(Ie,"History should not be empty.");if(s<0||s>=e.length)throw f(Ae,"Index should not be zero and higher or equal than history size.");this.history=e.map(r=>W(r,""))}attach(){this.attached||(this.attached=!0,this.sync(),m("back_button_pressed",this.back))}get current(){return this.history[this.index]}detach(){this.attached=!1,N("back_button_pressed",this.back)}forward(){this.go(1)}go(e,s){const n=this.index+e,r=Math.min(Math.max(0,n),this.history.length-1);(n===r||s)&&this.replaceAndMove(r,this.history[r])}goTo(e,s){this.go(e-this.index,s)}get hasPrev(){return this.index>0}get hasNext(){return this.index!==this.history.length-1}get index(){return this._index}push(e){this.hasNext&&this.history.splice(this.index+1),this.replaceAndMove(this.index+1,W(e,this.current.pathname))}replace(e){this.replaceAndMove(this.index,W(e,this.current.pathname))}replaceAndMove(e,s){const n=e-this.index;if(!n&&this.current===s)return;const r=this.current;if(this.index!==e){const i=this._index;this._index=e,this.attached&&i>0!=e>0&&this.sync()}this.history[e]=s,this.ee.emit("change",{navigator:this,from:r,to:this.current,delta:n})}sync(){this.postEvent("web_app_setup_back_button",{is_visible:!!this.index})}}function H({params:t,...e}){return{...t||{hash:"",search:""},...e}}function O(t){const e=typeof t=="string"?t.startsWith("/"):!!(t.pathname&&t.pathname.startsWith("/")),s=x(t);return`${e?s.pathname:s.pathname.slice(1)}${s.search}${s.hash}`}function G(t,e,s){let n,r;typeof t=="string"?n=t:(n=O(t),s=t.state,r=t.id);const{pathname:i,search:o,hash:a}=new URL(n,`http://a${k(e,"/")}`);return{id:r,pathname:i,params:{hash:a,search:o,state:s}}}async function R(t){return t===0?!0:Promise.race([new Promise(e=>{const s=K("popstate",()=>{s(),e(!0)});window.history.go(t)}),new Promise(e=>{setTimeout(e,50,!1)})])}async function Cs(){if(window.history.length<=1||(window.history.pushState(null,""),await R(1-window.history.length)))return;let t=await R(-1);for(;t;)t=await R(-1)}function _e(t){return x(t).pathname}const we=0,j=1,z=2;class fe{constructor(e,s,{postEvent:n,hashMode:r="classic",base:i}={}){c(this,"navigator"),c(this,"ee",new P),c(this,"hashMode"),c(this,"base"),c(this,"attached",!1),c(this,"onPopState",({state:o})=>{if(o===null)return this.push(this.parsePath(window.location.href));o===we?window.history.forward():o===j&&this.back(),o===z&&this.forward()}),c(this,"onNavigatorChange",async({to:o,from:a,delta:h})=>{this.attached&&await this.syncHistory(),this.ee.emit("change",{delta:h,from:H(a),to:H(o),navigator:this})}),c(this,"on",this.ee.on.bind(this.ee)),c(this,"off",this.ee.off.bind(this.ee)),this.navigator=new vt(e.map(o=>G(o,"/")),s,n),this.navigator.on("change",o=>{this.onNavigatorChange(o)}),this.hashMode=r,this.base=_e(i||"")}async attach(){this.attached||(this.attached=!0,this.navigator.attach(),window.addEventListener("popstate",this.onPopState),await this.syncHistory())}back(){this.navigator.back()}detach(){this.attached=!1,this.navigator.detach(),window.removeEventListener("popstate",this.onPopState)}forward(){return this.navigator.forward()}get index(){return this.navigator.index}get id(){return this.navigator.current.id}go(e,s){return this.navigator.go(e,s)}goTo(e,s){this.navigator.goTo(e,s)}get hash(){return(this.navigator.current.params||{}).hash||""}get hasPrev(){return this.navigator.hasPrev}get hasNext(){return this.navigator.hasNext}get history(){return this.navigator.history.map(H)}get path(){return O(this)}get pathname(){return this.navigator.current.pathname}parsePath(e){let s=x(e);return this.hashMode&&(s=x(s.hash.slice(1))),{pathname:s.pathname,search:s.search,hash:s.hash}}push(e,s){const n=G(e,this.path),{state:r=s}=n.params;this.navigator.push({...n,params:{...n.params,state:r}})}replace(e,s){const n=G(e,this.path),{state:r=s}=n.params;this.navigator.replace({...n,params:{...n.params,state:r}})}renderPath(e){const s=(this.base.length===1?"":this.base)+k(O(e),"/");return this.hashMode?k(s.slice(1),this.hashMode==="classic"?"#":"#/"):s}async syncHistory(){window.removeEventListener("popstate",this.onPopState);const{state:e}=this,s=this.renderPath(this);await Cs(),this.hasPrev&&this.hasNext?(window.history.replaceState(j,""),window.history.pushState(e,"",s),window.history.pushState(z,""),await R(-1)):this.hasPrev?(window.history.replaceState(j,""),window.history.pushState(e,"",s)):this.hasNext?(window.history.replaceState(e,s),window.history.pushState(z,""),await R(-1)):(window.history.replaceState(we,""),window.history.pushState(e,"",s)),window.addEventListener("popstate",this.onPopState)}get search(){return(this.navigator.current.params||{}).search||""}get state(){return(this.navigator.current.params||{}).state}}function Et(t){t||(t={});const{href:e,hash:s}=window.location;let n=O(t.hashMode===null?e:s.includes("?")?s.slice(1):`?${s.slice(1)}`);const r=t.base?_e(t.base):void 0;if(r){if(!n.startsWith(r))throw f(Re,`Path "${n}" expected to be starting with "${r}"`);n=n.slice(r.length)}return new fe([n],0,t)}function Is(t){const e=t.match(/#(.+)/);return e?e[1]:null}function As(t,e){if(he()){const s=sessionStorage.getItem(t);if(s)try{const{index:n,history:r}=JSON.parse(s);return new fe(r,n,e)}catch(n){console.error("Unable to restore hash navigator state.",n)}}return Et(e)}function Rs(t,e){const s=As(t,e),n=()=>sessionStorage.setItem(t,JSON.stringify({index:s.index,history:s.history}));return s.on("change",n),n(),s}const Pt=Object.freeze(Object.defineProperty({__proto__:null,BackButton:He,BasicNavigator:vt,BiometryManager:st,BrowserNavigator:fe,ClosingBehavior:rt,CloudStorage:ot,ERR_INVALID_PATH_BASE:Re,ERR_INVOKE_CUSTOM_METHOD_RESPONSE:xe,ERR_METHOD_PARAMETER_UNSUPPORTED:Pe,ERR_METHOD_UNSUPPORTED:Ee,ERR_NAVIGATION_HISTORY_EMPTY:Ie,ERR_NAVIGATION_INDEX_INVALID:Ae,ERR_NAVIGATION_ITEM_INVALID:Rt,ERR_PARSE:X,ERR_SSR_INIT:kt,ERR_TIMED_OUT:Te,ERR_UNEXPECTED_TYPE:Ce,ERR_UNKNOWN_ENV:Se,EventEmitter:P,HapticFeedback:at,InitData:ct,Invoice:ht,MainButton:pt,MiniApp:lt,Popup:dt,QRScanner:_t,SDKError:q,SettingsButton:ft,SwipeBehavior:gt,ThemeParams:mt,Utils:bt,Viewport:wt,array:it,bindMiniAppCSSVars:ws,bindThemeParamsCSSVars:ys,bindViewportCSSVars:vs,boolean:b,captureSameReq:te,classNames:V,compareVersions:Ne,createBrowserNavigatorFromLocation:Et,createPostEvent:Le,createSafeURL:x,date:ae,getHash:Is,getPathname:_e,initBackButton:Yt,initBiometryManager:Qt,initClosingBehavior:Zt,initCloudStorage:ts,initHapticFeedback:ss,initInitData:ns,initInvoice:is,initMainButton:os,initMiniApp:hs,initNavigator:Rs,initPopup:us,initQRScanner:ls,initSettingsButton:ds,initSwipeBehavior:_s,initThemeParams:fs,initUtils:ms,initViewport:bs,initWeb:Es,invokeCustomMethod:E,isColorDark:re,isIframe:ee,isPageReload:he,isRGB:L,isRGBShort:Me,isSDKError:yt,isSDKErrorOfType:Ts,isSSR:Ps,isTMA:Ss,json:g,mergeClassNames:$t,mockTelegramEnv:xs,number:y,off:N,on:m,parseInitData:rs,parseLaunchParams:M,parseThemeParams:le,postEvent:S,request:d,requestBiometryInfo:nt,requestThemeParams:gs,requestViewport:de,retrieveLaunchParams:et,rgb:je,searchParams:$,serializeLaunchParams:Ze,serializeThemeParams:ce,setCSSVar:w,setDebug:It,setTargetOrigin:Lt,string:p,subscribe:ve,supports:v,targetOrigin:Ue,toRGB:ne,unsubscribe:Y,urlToPath:O,withTimeout:se},Symbol.toStringTag,{value:"Module"}));console.log("📦 Available Telegram SDK exports:",Object.keys(Pt));class ks{constructor(){this.currentUser=null,this.isTelegram=!1,this.init()}init(){console.log("🚀 Starting TeleBlog..."),this.showScreen("welcome"),this.initializeTelegram(),this.setupEventListeners()}initializeTelegram(){try{this.checkForTelegramUser()}catch{console.log("❌ Telegram SDK init failed, using fallback methods"),this.checkClassicTelegram()}}checkForTelegramUser(){const e=Pt;for(const s in e)if(e[s]&&e[s].user){console.log(`✅ User found via ${s}:`,e[s].user),this.handleTelegramUser(e[s].user);return}this.checkClassicTelegram()}checkClassicTelegram(){var s,n;const e=(s=window.Telegram)==null?void 0:s.WebApp;if(e){console.log("📱 Classic Telegram WebApp detected");try{if(e.ready(),e.expand(),(n=e.initDataUnsafe)!=null&&n.user){console.log("✅ User found via classic WebApp:",e.initDataUnsafe.user),this.handleTelegramUser(e.initDataUnsafe.user);return}if(e.initData){console.log("📋 Raw initData available"),this.parseInitData(e.initData);return}}catch{console.log("❌ Classic Telegram init failed")}}console.log("🌐 No Telegram user data found - using demo mode")}parseInitData(e){try{const n=new URLSearchParams(e).get("user");if(n){const r=JSON.parse(decodeURIComponent(n));console.log("👤 Parsed user from initData:",r),this.handleTelegramUser(r)}}catch(s){console.error("Error parsing initData:",s)}}handleTelegramUser(e){this.currentUser={id:e.id,firstName:e.first_name||e.firstName,lastName:e.last_name||e.lastName,username:e.username,photoUrl:e.photo_url||e.photoUrl},console.log("✅ Telegram user authenticated:",this.currentUser.username),this.updateUserInterface(),this.showScreen("main-app"),this.loadFeed()}updateUserInterface(){if(!this.currentUser)return;const e=this.currentUser.firstName+(this.currentUser.lastName?" "+this.currentUser.lastName:""),s=this.currentUser.username?"@"+this.currentUser.username:"Telegram User";console.log("📝 Updating UI for:",s);const n=document.getElementById("profile-name"),r=document.getElementById("profile-username"),i=document.getElementById("profile-avatar");n&&(n.textContent=e),r&&(r.textContent=s),i&&this.currentUser.photoUrl?i.src=this.currentUser.photoUrl:i&&(i.src="https://cdn-icons-png.flaticon.com/512/3177/3177440.png")}setupEventListeners(){document.getElementById("start-btn").addEventListener("click",()=>{console.log("🎯 Get Started clicked"),this.currentUser?(this.showScreen("main-app"),this.loadFeed()):(this.currentUser={id:"demo",firstName:"Demo",lastName:"User",username:"demo_user"},this.updateUserInterface(),this.showScreen("main-app"),this.loadFeed())}),document.querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",s=>{const n=s.target.getAttribute("data-tab");this.switchTab(n)})}),document.getElementById("publish-btn").addEventListener("click",()=>{this.publishPost()}),document.getElementById("logout-btn").addEventListener("click",()=>{confirm("Are you sure you want to logout?")&&this.logout()})}showScreen(e){console.log("🔄 Switching to:",e),document.querySelectorAll(".screen").forEach(s=>{s.classList.remove("active")}),document.getElementById(e).classList.add("active")}switchTab(e){console.log("🔀 Switching tab to:",e),document.querySelectorAll(".tab").forEach(s=>{s.classList.remove("active")}),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.querySelectorAll(".tab-content").forEach(s=>{s.classList.remove("active")}),document.getElementById(e).classList.add("active"),e==="feed"&&this.loadFeed(),e==="profile"&&this.loadProfile()}loadFeed(){var r;const e=document.getElementById("posts-container"),s=(r=this.currentUser)!=null&&r.username?"@"+this.currentUser.username:"You",n=[{title:"Welcome to TeleBlog! 🎉",content:"Start writing your thoughts and share them with the world.",author:s,likes:0,views:1},{title:"Getting Started Guide",content:"Click the Write tab to create your first post. Your content will be saved automatically.",author:s,likes:0,views:1}];e.innerHTML=n.map(i=>`
            <div class="post-card">
                <h3>${i.title}</h3>
                <p>${i.content}</p>
                <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.875rem; color: #666;">
                    <span>By ${i.author}</span>
                    <span>❤️ ${i.likes} | 👁️ ${i.views}</span>
                </div>
            </div>
        `).join("")}loadProfile(){this.currentUser&&this.updateUserInterface(),document.getElementById("posts-count").textContent="2",document.getElementById("likes-count").textContent="0",document.getElementById("views-count").textContent="2"}publishPost(){const e=document.getElementById("post-title").value.trim(),s=document.getElementById("post-content").value.trim();if(!e||!s){alert("Please fill in both title and content");return}const n=document.getElementById("publish-btn"),r=n.textContent;n.textContent="Publishing...",n.disabled=!0,setTimeout(()=>{document.getElementById("post-title").value="",document.getElementById("post-content").value="",n.textContent=r,n.disabled=!1,alert("Post published successfully!"),this.switchTab("feed")},1e3)}logout(){this.currentUser=null,this.isTelegram=!1,this.showScreen("welcome"),document.getElementById("profile-name").textContent="User Name",document.getElementById("profile-username").textContent="@username"}}document.addEventListener("DOMContentLoaded",()=>{console.log("📄 DOM ready - starting TeleBlog"),window.teleBlogApp=new ks});window.Telegram&&window.Telegram.WebApp&&console.log("🌍 Global Telegram WebApp detected");
